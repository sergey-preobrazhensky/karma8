# PHP Developer. Test Cases
Вы разрабатываете сервис для рассылки уведомлений об истекающих
подписках.

Примерно за три дня до истечения срока подписки, нужно отправить
письмо пользователю с текстом "{username}, your subscription is expiring
soon".

## Имеем следующее

1. Таблица **users** в DB с пользователями (1 000 000 строк):

   username — имя

   email — емейл

   validts — unix ts до которого действует ежемесячная подписка

   confirmed — 0 или 1 в зависимости от того, подтвердил ли
   пользователь свой емейл по ссылке (пользователю после
   регистрации приходит письмо с уникальный ссылкой на указанный
   емейл, если он нажал на ссылку в емейле в этом поле
   устанавливается 1)


2. Таблица emails в DB с данными проверки емейл на валидность:
   email — емейл
   checked — 0 или 1 (был ли проверен)
   valid — 0 или 1 (является ли валидным)


3. Функция check_email( $email )

   Проверяет емейл на валидность и возвращает 0 или 1. Функция
   работает от 1 секунды до 1 минуты. Вызов функции платный.


4. Функция send_email( $email, $from, $to, $subj, $body )

   Отсылает емейл. Функция работает от 1 секунды до 10 секунд.
   
## Ограничения

   ➔ Необходимо регулярно отправлять емейлы об истечении срока
   подписки, но только на те емейлы, на которые письмо точно дойдёт.
   
   ➔ Можно использовать cron.
   
   ➔ Можно создать необходимые таблицы в DB или изменить
   существующие.
   
   ➔ Можно использовать вызов http://localhost/script.php для вызова
   своих скриптов.
   
   ➔ Для функций check_email и send_email нужно написать "заглушки".
   
   ➔ Не нужно использовать ООП.
   
   ➔ Можно задавать вопросы и уточнять условия задачи.
   
   ➔ Код разместить в GitHub.


## Решение
Выделяем отельные процессы:
1. Добавление email на проверку
2. Проверка email
3. Отправка уведомлений

Каждый процесс запускается отдельно по крону

2 и 3 процессы могут быть запущены в несколько потоков для ускорения обработки

Проверка email сначала учитывает возможные ошибки в данных и наличие подтверждения от пользователя.
Проверка email вызывается только в момент наступления необходимости отправки рассылки. 

Добавлены поля:

- users.notified - для сохранения факта отправки уведмления. Должно быть сброшено при продлении подписки.

- emails.processing и users.processing - для исключения параллельной обработки одних и тех же данных.

Добавлены необходимые индексы для поисковых запросов.